!function(h){var o={placeholder:"Select options",columns:1,search:!1,searchOptions:{default:"Search",showOptGroups:!1,onSearch:function(t){}},selectAll:!1,selectGroup:!1,minHeight:200,maxHeight:null,showCheckbox:!0,jqActualOpts:{},onLoad:function(t){h(t).hide()},onOptionClick:function(t,e){},maxWidth:null,minSelect:!1,maxSelect:!1},i=1;function s(t,e){this.element=t,this.options=h.extend({},o,e),this.load()}s.prototype={load:function(){var e=this;if("SELECT"!=e.element.nodeName||h(e.element).hasClass("jqmsLoaded"))return!0;h(e.element).addClass("jqmsLoaded"),h(e.element).after('<div class="ms-options-wrap"><button>None Selected</button><div class="ms-options"><ul></ul></div></div>');var t=h(e.element).next(".ms-options-wrap").find("> button:first-child"),o=h(e.element).next(".ms-options-wrap").find("> .ms-options"),i=o.find("> ul"),s=!!h(e.element).find("optgroup").length,n=null;"number"==typeof e.options.width?(o.parent().css("position","relative"),n=e.options.width):"string"==typeof e.options.width?(h(e.options.width).css("position","relative"),n="100%"):o.parent().css("position","relative");var l,a=h(window).height()-o.offset().top-20;e.options.maxHeight&&(a=(a=h(window).height()-o.offset().top-20)<e.options.minHeight?e.options.minHeight:maxheight),a=a<e.options.minHeight?e.options.minHeight:a,o.css({maxWidth:n,minHeight:e.options.minHeight,maxHeight:a,overflow:"auto"}).hide(),o.bind("touchmove mousewheel DOMMouseScroll",function(t){var e;h(this).outerHeight()<h(this)[0].scrollHeight&&(e=(e=t.originalEvent).wheelDelta||-e.detail,h(this).outerHeight()+h(this)[0].scrollTop>h(this)[0].scrollHeight&&(t.preventDefault(),this.scrollTop+=e<0?1:-1))}),h(document).off("click.ms-hideopts").on("click.ms-hideopts",function(t){h(t.target).closest(".ms-options-wrap").length||h(".ms-options-wrap > .ms-options:visible").hide()}),t.bind("mousedown",function(t){return 1!=t.which||(h(".ms-options-wrap > .ms-options:visible").each(function(){h(this).parent().prev()[0]!=o.parent().prev()[0]&&h(this).hide()}),o.toggle(),void(o.is(":visible")&&(o.css("maxHeight",""),t=h(window).height()-o.offset().top-20,e.options.maxHeight&&(t=(t=h(window).height()-o.offset().top-20)<e.options.minHeight?e.options.minHeight:maxheight),t=t<e.options.minHeight?e.options.minHeight:t,o.css("maxHeight",t))))}).click(function(t){t.preventDefault()}),e.options.placeholder&&t.text(e.options.placeholder),e.options.search&&(i.before('<div class="ms-search"><input type="text" value="" placeholder="'+e.options.searchOptions.default+'" /></div>'),(l=o.find(".ms-search input")).on("keyup",function(){return h(this).data("lastsearch")==h(this).val()||(h(this).data("lastsearch",h(this).val()),"function"==typeof e.options.searchOptions.onSearch&&e.options.searchOptions.onSearch(e.element),void i.find("li:not(.optgroup)").each(function(){-1<h(this).text().toLowerCase().indexOf(l.val().toLowerCase())?h(this).show():h(this).hasClass("selected")||h(this).hide(),!e.options.searchOptions.showOptGroups&&h(this).closest("li.optgroup")&&(h(this).closest("li.optgroup").show(),h(this).closest("li.optgroup").find("li:visible").length?h(this).closest("li.optgroup").show():h(this).closest("li.optgroup").hide())}))})),e.options.selectAll&&i.before('<a href="#" class="ms-selectall global">Select all</a>'),o.on("click",".ms-selectall",function(t){t.preventDefault(),h(this).hasClass("global")?(i.find("li:not(.optgroup)").filter(":not(.selected)").length?i.find("li:not(.optgroup)").filter(":not(.selected)").find('input[type="checkbox"]'):i.find('li:not(.optgroup).selected input[type="checkbox"]')).trigger("click"):h(this).closest("li").hasClass("optgroup")&&((t=h(this).closest("li.optgroup")).find("li:not(.selected)").length?t.find('li:not(.selected) input[type="checkbox"]'):t.find('li.selected input[type="checkbox"]')).trigger("click")});var p=[];h(e.element).children().each(function(){if("OPTGROUP"==this.nodeName){var t=[];h(this).children("option").each(function(){t[h(this).val()]={name:h(this).text(),value:h(this).val(),checked:h(this).prop("selected")}}),p.push({label:h(this).attr("label"),options:t})}else{if("OPTION"!=this.nodeName)return!0;p.push({name:h(this).text(),value:h(this).val(),checked:h(this).prop("selected")})}}),e.loadOptions(p),s?(i.find("> li:not(.optgroup)").css({float:"left",width:100/e.options.columns+"%"}),i.find("li.optgroup").css({clear:"both"}).find("> ul").css({"column-count":e.options.columns,"column-gap":0,"-webkit-column-count":e.options.columns,"-webkit-column-gap":0,"-moz-column-count":e.options.columns,"-moz-column-gap":0}),this._ieVersion()&&this._ieVersion()<10&&i.find("li.optgroup > ul > li").css({float:"left",width:100/e.options.columns+"%"})):(i.css({"column-count":e.options.columns,"column-gap":0,"-webkit-column-count":e.options.columns,"-webkit-column-gap":0,"-moz-column-count":e.options.columns,"-moz-column-gap":0}),this._ieVersion()&&this._ieVersion()<10&&i.find("> li").css({float:"left",width:100/e.options.columns+"%"})),o.on("click",'input[type="checkbox"]',function(){h(this).closest("li").toggleClass("selected"),o.parent().prev().find('option[value="'+h(this).val()+'"]').prop("selected",h(this).is(":checked")).closest("select").trigger("change"),"function"==typeof e.options.onOptionClick&&e.options.onOptionClick(),e._updatePlaceholderText()}),"function"==typeof e.options.onLoad?e.options.onLoad(e.element):h(e.element).hide()},loadOptions:function(t,e){e="boolean"!=typeof e||e;var o,i=this,s=h(i.element).next(".ms-options-wrap").find("> .ms-options > ul");for(o in e&&s.find("> li").remove(),t){var n=t[o],l=h("<li></li>");if(n.hasOwnProperty("options"))for(var a in l.addClass("optgroup"),l.append('<span class="label">'+n.label+"</span>"),l.find("> .label").css({clear:"both"}),i.options.selectGroup&&l.append('<a href="#" class="ms-selectall">Select all</a>'),l.append("<ul></ul>"),n.options){var p=n.options[a],c=h("<li></li>").addClass("ms-reflow");i._addOption(c,p),l.find("> ul").append(c)}else n.hasOwnProperty("value")&&(l.addClass("ms-reflow"),i._addOption(l,n));s.append(l)}s.find('.ms-reflow input[type="checkbox"]').each(function(t){var e;h(this).css("display").match(/block$/)&&(e=(e=h(this).outerWidth())||15,h(this).closest("label").css("padding-left",2*parseInt(h(this).closest("label").css("padding-left"))+e),h(this).closest(".ms-reflow").removeClass("ms-reflow"))}),i._updatePlaceholderText()},unload:function(){h(this.element).next(".ms-options-wrap").remove(),h(this.element).show(function(){h(this).css("display","").removeClass("jqmsLoaded")})},reload:function(){h(this.element).next(".ms-options-wrap").remove(),h(this.element).removeClass("jqmsLoaded"),this.load()},_updatePlaceholderText:function(){var t=this,e=h(t.element).next(".ms-options-wrap").find("> button:first-child"),o=h(t.element).next(".ms-options-wrap").find("> .ms-options"),i=o.parent().prev(),s=[];i.find("option:selected").each(function(){s.push(h(this).text())}),e.text(s.join(", "));i=e.clone().css({display:"inline",width:"auto",visibility:"hidden"}).appendTo(o.parent()),o=void 0!==h.fn.actual?i.actual("width",t.options.jqActualOpts):i.width();(void 0!==h.fn.actual?e.actual("width",t.options.jqActualOpts):e.width())<o?e.text(s.length+" selected"):s.length?e.text(s.join(", ")):e.text(t.options.placeholder),i.remove()},_addOption:function(t,e){t.text(e.name),t.prepend(h('<input type="checkbox" value="" title="" />').val(e.value).attr("title",e.name).attr("id","ms-opt-"+i)),e.checked&&(t.addClass("default"),t.addClass("selected"),t.find('input[type="checkbox"]').prop("checked",!0));e=h("<label></label>").attr("for","ms-opt-"+i);t.wrapInner(e),this.options.showCheckbox||t.find('input[id="ms-opt-'+i+'"]').hide(),i+=1},_ieVersion:function(){var t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("msie")&&parseInt(t.split("msie")[1])}},h.fn.multiselect=function(e){var o,i=arguments;return void 0===e||"object"==typeof e?this.each(function(){h.data(this,"plugin_multiselect")||h.data(this,"plugin_multiselect",new s(this,e))}):"string"==typeof e&&"_"!==e[0]&&"init"!==e?(this.each(function(){var t=h.data(this,"plugin_multiselect");t instanceof s&&"function"==typeof t[e]&&(o=t[e].apply(t,Array.prototype.slice.call(i,1))),"unload"===e&&h.data(this,"plugin_multiselect",null)}),o):void 0}}(jQuery);
